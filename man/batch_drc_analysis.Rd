% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/batch_drc_analysis.R
\name{batch_drc_analysis}
\alias{batch_drc_analysis}
\title{Batch Dose–Response Curve (DRC) Analysis for Multiple Plates}
\usage{
batch_drc_analysis(
  batch_results,
  normalize = FALSE,
  enforce_bottom_threshold = FALSE,
  bottom_threshold = 60,
  r_sqr_threshold = 0.8,
  output_dir = NULL,
  generate_reports = TRUE,
  verbose = TRUE
)
}
\arguments{
\item{batch_results}{A named list containing results from
\code{\link[=batch_ratio_analysis]{batch_ratio_analysis()}}. Each element must contain the field
\code{result$modified_ratio_table}, which will be used for the DRC fit.}

\item{normalize}{Logical. Whether to normalize responses inside \code{fit_drc_3pl()}.}

\item{enforce_bottom_threshold}{Logical. If \code{TRUE}, forces the lower plateau of
the fitted curve to stay above \code{bottom_threshold}.}

\item{bottom_threshold}{Numeric. Minimum acceptable bottom asymptote value.}

\item{r_sqr_threshold}{Minimum acceptable R-squared for accepting a curve fit.}

\item{output_dir}{Directory where individual plate results and consolidated
batch reports will be saved. Defaults to the working directory.}

\item{generate_reports}{Logical. If \code{TRUE} (default), generates a consolidated
Excel report summarizing all DRC fits.}

\item{verbose}{Logical. If \code{TRUE}, prints progress details.}
}
\value{
A named list of DRC analysis results for each plate.
Each entry contains:

\describe{
\item{plate_info}{A list with metadata: \code{data_file}, \code{info_sheet}, \code{sheet_number}.}
\item{drc_result}{Full result object from \code{fit_drc_3pl()}, including fitted parameters,
summary tables, final summary tables, QC metrics, and counts.}
\item{timestamp}{Time when the plate was processed.}
}

If \code{generate_reports = TRUE}, also saves:
\itemize{
\item \code{batch_drc_analysis_report.xlsx}
\item Individual Excel files: \verb{drc_results_<plate>.xlsx}
}
}
\description{
\code{batch_drc_analysis()} performs automated dose–response curve (DRC) fitting
across multiple plates previously processed by \code{batch_ratio_analysis()}.

It extracts the \code{modified_ratio_table} from each plate, applies a
3-parameter logistic regression via \code{\link[=fit_drc_3pl]{fit_drc_3pl()}}, and generates:
\itemize{
\item Per-plate DRC result files (optional)
\item A consolidated batch DRC report (\code{batch_drc_analysis_report.xlsx})
}

The function computes fitting success rates, R-squared metrics, curve
qualities, and compiles them into structured summary sheets.
}
\details{
For each plate in \code{batch_results}, the function:
\enumerate{
\item Extracts the \code{modified_ratio_table} produced during ratio normalization.
\item Ensures the table contains valid data (non-empty and with column names).
\item Performs a 3-parameter logistic fit via \code{\link[=fit_drc_3pl]{fit_drc_3pl()}}, where:
\itemize{
\item The first column is assumed to be log(inhibitor concentration)
\item Remaining columns are compound responses
}
\item Stores:
\itemize{
\item Full DRC results for each compound
\item Summary tables, final tables, and curve quality metrics
\item Optional Excel result files per plate
}
}

After processing all plates, if \code{generate_reports = TRUE}, a consolidated
Excel file (\code{batch_drc_analysis_report.xlsx}) is created, containing:
\itemize{
\item \strong{Summary} sheet — plate-level statistics
\item \strong{All_Results} — merged results for all compounds across plates
\item \strong{Curve_Quality} — QC-oriented summary (R², slope, quality flag)
\item A \strong{_summary} and \strong{_final_summary} sheet per plate
}
}
\examples{
\dontrun{

# Assuming you already ran batch_ratio_analysis()
ratio_results <- batch_ratio_analysis("experiment_folder")

# Run DRC for all plates
drc_results <- batch_drc_analysis(ratio_results)

# Specify thresholds and output directory
drc_results <- batch_drc_analysis(
  batch_results = ratio_results,
  r_sqr_threshold = 0.9,
  bottom_threshold = 50,
  output_dir = "drc_output"
)

# Skip generating the Excel report
batch_drc_analysis(
  batch_results = ratio_results,
  generate_reports = FALSE
)
}


}
\seealso{
\itemize{
\item \code{\link[=fit_drc_3pl]{fit_drc_3pl()}} — Fits the dose–response curve for a single plate.
\item \code{\link[=batch_ratio_analysis]{batch_ratio_analysis()}} — Preprocessing step generating modified ratio tables.
\item \code{openxlsx} — Excel manipulation used for reporting.
}
}
