% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ratio_dose_response_v2.R
\name{ratio_dose_response_v2}
\alias{ratio_dose_response_v2}
\title{Process and Analyze Dose-Response Ratio Data with Flexible Control Options}
\usage{
ratio_dose_response_v2(
  data,
  control_0perc = NULL,
  control_100perc = NULL,
  split_replicates = TRUE,
  info_table = NULL,
  save_to_excel = NULL,
  verbose = TRUE,
  low_value_threshold = 3000
)
}
\arguments{
\item{data}{Data frame containing \strong{raw dose-response experimental data} with specific
structure typically exported from plate readers. Must have at least 43 rows with
column names in row 9.}

\item{control_0perc}{\strong{Either} a single numeric value (e.g., 16) for fixed 0\% control
\strong{or} a character string specifying the column name for 0\% control (background control).
When using fixed value, a new column 'Fixed_0perc' is created with this value.}

\item{control_100perc}{\strong{Either} a numeric vector of column positions (e.g., c(12, 24))
\strong{or} a character vector of column names for 100\% control(s). When using multiple
columns, their row-wise means are calculated to create a new 'Mean_100perc' column.}

\item{split_replicates}{Logical indicating whether to split experimental replicates
into separate columns (default: TRUE). Creates technical replicates with ".2" suffix.}

\item{info_table}{Data frame with experimental metadata containing at least 4 columns:
log(inhibitor), Plate_Row, Construct, and Compound information.}

\item{save_to_excel}{Character string specifying Excel file path for saving processed results
(default: NULL, no saving).}

\item{verbose}{Logical indicating whether to display progress messages (default: TRUE).}

\item{low_value_threshold}{Numeric threshold for filtering low luciferase signals
(default: 3000). Values below this are replaced with NA.}
}
\value{
A list containing the following components:
\itemize{
\item \code{original_ratio_table}: Original calculated ratio table from data
\item \code{modified_ratio_table}: Processed and formatted table ready for analysis
\item \code{general_means}: Data frame with general control means (when controls provided)
\item \code{interval_means}: Data frame with construct-specific means and quality metrics
\item \code{construct_intervals}: List mapping constructs to row intervals
\item \code{control_info}: Information about how controls were processed
}
}
\description{
Processes experimental data from dose-response assays to calculate ratios,
perform quality assessment, and prepare data for downstream curve fitting analysis.
This enhanced version supports both traditional column-based controls and new fixed-value
controls with multiple 100\% control columns.
}
\details{
This function processes dose-response data through a comprehensive pipeline. The enhanced
version supports two control specification modes:

\strong{New Fixed-Value Mode (Recommended for New Experiments):}
\itemize{
\item \code{control_0perc = 16}: Uses fixed value 16 for all 0\% control measurements
\item \code{control_100perc = c(12, 24)}: Uses columns 12 and 24 as duplicate 100\% controls
\item Creates new columns: 'Fixed_0perc' (all values = 16) and 'Mean_100perc' (row-wise means)
\item Removes original 100\% control columns after calculating means
\item Reorganizes: Fixed_0perc (first), experimental columns (middle), Mean_100perc (last)
}

\strong{Traditional Column Name Mode (Backward Compatible):}
\itemize{
\item \code{control_0perc = "DMSO"}: Uses column named "DMSO" for 0\% control
\item \code{control_100perc = "Staurosporine"}: Uses single column for 100\% control
\item Maintains original column structure and positions
}

\strong{Key Features of Enhanced Version:}
\itemize{
\item \strong{Flexible Control Specification}: Accepts both fixed values and column names/positions
\item \strong{Multiple 100\% Controls}: Automatically averages duplicate 100\% control columns
\item \strong{Automatic Biological Replicate Handling}: Distinguishes replicates with suffixes
\item \strong{Quality Control Metrics}: Calculates Z-score, assay window, and signal quality
\item \strong{Technical Replicate Splitting}: Separates replicates into distinct columns
\item \strong{Metadata Integration}: Maps experimental metadata to data columns
}

\strong{Data Processing Pipeline:}
\enumerate{
\item \strong{Data Validation}: Checks minimum row requirements and structure
\item \strong{Subtable Extraction}: Separates measurement subtables (rows 10-25 and 28-43)
\item \strong{Low Value Filtering}: Replaces values below threshold with NA
\item \strong{Ratio Calculation}: Computes (subtable2 / subtable1) * 1000
\item \strong{Control Processing}: Implements fixed-value or column-based control strategy
\item \strong{Quality Assessment}: Calculates metrics for each construct
\item \strong{Data Transformation}: Transposes and renames columns based on metadata
\item \strong{Replicate Splitting}: Separates technical replicates if requested
\item \strong{Log(Inhibitor) Addition}: Adds concentration information as first column
}

\strong{Data Structure Requirements:}
\preformatted{
  Rows 1-8:     Headers and metadata (ignored)
  Row 9:        Column names for data extraction
  Rows 10-25:   First measurement (e.g., donor channel)
  Rows 26-27:   Separator (ignored)
  Rows 28-43:   Second measurement (e.g., acceptor channel)
}

\strong{Quality Metrics (When info_table Provided):}
\itemize{
\item \strong{Luciferase Signal}: >100000 (high), 10000-100000 (medium), 1000-10000 (low)
\item \strong{Assay Window}: >3 (high), 2-3 (medium), 1.5-2 (low)
\item \strong{Z-Score}: >0.7 (high), 0.5-0.7 (medium), 0.25-0.5 (low)
\item \strong{Overall Quality}: Determined by lowest-performing metric
}
}
\section{Control Processing Details}{

\strong{When using fixed-value mode (control_0perc is numeric):}
\enumerate{
\item Creates new column 'Fixed_0perc' with all values equal to control_0perc
\item Calculates row-wise means of specified 100\% control columns
\item Creates new column 'Mean_100perc' with these averages
\item Removes original 100\% control columns from the data
\item Reorganizes columns: Fixed_0perc → experimental columns → Mean_100perc
\item After transposition: Fixed_0perc becomes first row, Mean_100perc becomes last row
}

\strong{When using column name mode (control_0perc is character):}
\enumerate{
\item Uses specified columns directly as controls
\item Reorganizes columns: control_0perc column → experimental columns → control_100perc column
\item No new columns created, original structure maintained
}
}

\section{Biological Replicate Handling}{

The function automatically detects and distinguishes biological replicates
(same Construct:Compound combination) by adding numeric suffixes:
\itemize{
\item First occurrence: "PIP4K2C:AZ-3458"
\item Second occurrence: "PIP4K2C:AZ-3458_2"
\item Third occurrence: "PIP4K2C:AZ-3458_3"
}
This allows proper analysis of replicate experiments within the same dataset.
}

\section{Output Structure}{

The modified_ratio_table has the following structure:
\preformatted{
  Column 1:    log(inhibitor) concentration values (first row = NA)
  Columns 2-n: Experimental constructs (with .2 suffix for second technical replicate)
  
  Row structure:
  - Row 1:      0% control values (Fixed_0perc if using fixed-value mode)
  - Rows 2-(n-1): Experimental concentration measurements
  - Row n:      100% control values (Mean_100perc if using fixed-value mode)
}
}

\section{Note on Control Specifications}{

\itemize{
\item For \strong{new experiments}, use fixed-value mode: \code{control_0perc = 16, control_100perc = c(12, 24)}
\item For \strong{legacy data compatibility}, use column name mode: \code{control_0perc = "ColumnName", control_100perc = "ColumnName"}
\item You can mix modes: fixed 0\% with named 100\% control or vice versa
\item Column positions are 1-indexed (first data column after row names = position 1)
}
}

\examples{
\dontrun{
# --- NEW FIXED-VALUE MODE (Recommended) ---
# Using fixed 0\% control and column positions for 100\% control
processed_data <- ratio_dose_response_v2(
  data = raw_experimental_data,
  control_0perc = 16,                # Fixed value for 0\% control
  control_100perc = c(12, 24),       # Column positions for duplicate 100\% controls
  info_table = experiment_design,
  split_replicates = TRUE,
  save_to_excel = "processed_results.xlsx"
)

# Access the processed table ready for curve fitting
analysis_ready <- processed_data$modified_ratio_table

# View quality metrics for each construct
quality_metrics <- processed_data$interval_means

# --- TRADITIONAL MODE (Backward Compatible) ---
# Using column names for both controls
processed_old <- ratio_dose_response_v2(
  data = raw_experimental_data,
  control_0perc = "DMSO_Control",
  control_100perc = "Staurosporine_100pct",
  info_table = experiment_design
)

# --- WITHOUT METADATA (Basic Processing) ---
# Just calculate ratios with new control structure
basic_processed <- ratio_dose_response_v2(
  data = raw_data,
  control_0perc = 16,
  control_100perc = c(12, 24),
  info_table = NULL,
  split_replicates = FALSE
)
}

}
\references{
For dose-response data processing and quality control:
\itemize{
\item "Dose-Response Data Analysis in Drug Discovery" (Motulsky & Christopoulos, 2004)
\item "Assay Guidance Manual: Quantitative Biology and Pharmacology in Preclinical Drug Discovery" (NIH)
\item "Best Practices in Dose-Response Assay Development" (Journal of Biomolecular Screening)
}
}
\seealso{
\code{\link{fit_drc_3pl}} for dose-response curve fitting
\code{\link{plot_dose_response}} for visualization
\code{\link{calculate_assay_metrics}} for additional quality assessments
}
